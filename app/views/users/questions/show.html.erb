<div class="container mt-5 pt-2">
  <div class="row mb-5">
    <h4 class="font-weight-bold"><%= @question.title %></h4>
  </div>
  <div class="row mb-5">
    <h6><%= @question.body %></h6>
  </div>
  <div class="row mb-5">
    <%= attachment_image_tag @question, :image, format: "jpeg", size: "400x300" %>
  </div>
  <% if @question.user == current_user %>
    <div class="row mt-5 mb-3">
      <div class="col">
        <%= link_to "編集する", edit_question_path(@question), class: "btn btn-outline-dark" %>
      </div>
      <div class="col">
        <%= link_to "削除する", question_path, class: "btn btn-outline-dark", method: :delete, data: {confirm: "この質問を消しますか？"} %>
      </div>
    </div>
  <% end %>
  <h3>回答する</h3>
  <%= form_with model: [@question, @answer], local: true do |f| %>
    <div class="form-group">
      <label>回答内容</label>
      <%= f.text_area :body, class: 'form-control' %>
    </div>
    <div class="row mb-3">
      <div class="col-3"><%= f.label :投稿画像 %></div>
      <div class="col-4 mr-auto"><%= f.attachment_field :image %></div>
    </div>
    <div class="text-center">
      <%= f.submit "回答を送る", class: 'btn btn-primary' %>
    </div>
  <% end %>
  <div>
    <h3>回答一覧</h3>
    <table class="table table-striped">
      <% if @question.answers.any? %>
        <thead class="thead-light">
          <tr>
            <th>回答</th>
            <th>回答者</th>
            <th colspan="3"></th>
          </tr>
        </thead>
        <tbody>
          <% @question.answers.each do |answer| %>
            <tr>
              <td class="col-8">
                <%= answer.body %>
              </td>
              <td>
                <%= link_to answer.user.nickname, user_path(answer.user_id) %>
              </td>
              <td>
                <% if answer.niced_by?(current_user) %>
                  <%= link_to question_answer_nices_path(answer.question, answer), method: :delete do %>
                    <i class="far fa-thumbs-up fa-xs" aria-hidden="true"  style="color: red;">
                      <%= answer.nices.count %>
                    </i>
                  <% end %>
                <% else %>
                  <%= link_to question_answer_nices_path(answer.question, answer), method: :post do %>
                    <i class="far fa-thumbs-up fa-xs" aria-hidden="true">
                      <%= answer.nices.count %>
                    </i>
                  <% end %>
                <% end %>
              </td>
              <% if answer.user == current_user %>
                <td>
                  <%= link_to "編集", edit_question_answer_path(answer.question, answer), class: "btn btn-outline-dark" %>
                  <%= link_to "削除", question_answer_path(answer.question, answer), class: "btn btn-outline-dark", method: :delete %>
                </td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      <% else %>
        <p>回答はありません。</p>
      <% end %>
    </table>
  </div>
</div>